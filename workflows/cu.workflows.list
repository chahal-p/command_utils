#!/usr/bin/env bash

source _cu.workflows.common || exit 1

table=( -- "Name" "Next Scheduled" "$(printf "%s\n %s" "Recurring Interval" "(seconds)")" )

for name in $(list_workflow_cmds); do
  table+=(--)
  table+=("${name}")
  scheduled=$(get_workflow_scheduled "${name}")
  code=$?
  [ $code -eq 0 ] && [[ ${scheduled} -le $(cu.date.to-epoch --out_nanoseconds) ]] && scheduled="Now"
  [ $code -eq 0 ] || scheduled="-"

  [ "${scheduled}" != "-" ] && [ "${scheduled}" != "Now" ] && scheduled=$(cu.date.from-epoch --seconds "$((${scheduled} / 1000000000))")
  table+=("${scheduled}")
  interval=$(get_workflow_interval "${name}")
  code=$?
  [ $code -eq 0 ] || interval="-"
  table+=("${interval}")
done

cu.generate_table "${table[@]}"
